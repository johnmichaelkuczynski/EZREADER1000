<!DOCTYPE html>
<html>
<head>
    <title>Wix Embedding Debug Tool</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; background: #f0f0f0; }
        .debug-panel { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; border: 2px solid #ddd; }
        .iframe-container { width: 100%; height: 600px; border: 3px solid #007bff; border-radius: 8px; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .test-results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üîß Wix Embedding Debug Tool</h1>
    
    <div class="debug-panel">
        <h2>Server Headers Test</h2>
        <div id="headers-test">Testing headers...</div>
    </div>

    <div class="debug-panel">
        <h2>Iframe Embedding Test</h2>
        <div class="iframe-container">
            <iframe id="test-iframe" src="/" 
                    sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation allow-modals"
                    allow="camera; microphone; clipboard-write; clipboard-read">
            </iframe>
        </div>
        <div class="test-results">
            <div id="iframe-status">Loading iframe...</div>
            <div id="iframe-errors"></div>
        </div>
    </div>

    <div class="debug-panel">
        <h2>Wix Embedding Code</h2>
        <p>Copy this exact code into your Wix HTML embed:</p>
        <pre id="wix-code">
&lt;iframe src="https://your-deployed-url.replit.app/"
        width="100%" 
        height="600"
        style="border: none; border-radius: 8px; display: block;"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation allow-modals"
        allow="camera; microphone; clipboard-write; clipboard-read"
        loading="lazy"&gt;
    &lt;p&gt;Your browser doesn't support iframes.&lt;/p&gt;
&lt;/iframe&gt;</pre>
    </div>

    <script>
        // Test headers
        fetch('/')
            .then(response => {
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                
                let headerStatus = '<div class="success">‚úÖ Headers look good!</div>';
                headerStatus += '<pre>' + JSON.stringify(headers, null, 2) + '</pre>';
                
                // Check critical headers
                if (!headers['content-security-policy'] || !headers['content-security-policy'].includes('frame-ancestors *')) {
                    headerStatus += '<div class="error">‚ùå Missing frame-ancestors header</div>';
                }
                if (headers['x-frame-options']) {
                    headerStatus += '<div class="warning">‚ö†Ô∏è X-Frame-Options header present: ' + headers['x-frame-options'] + '</div>';
                }
                
                document.getElementById('headers-test').innerHTML = headerStatus;
            })
            .catch(error => {
                document.getElementById('headers-test').innerHTML = '<div class="error">‚ùå Header test failed: ' + error.message + '</div>';
            });

        // Test iframe
        const iframe = document.getElementById('test-iframe');
        let iframeLoaded = false;
        
        iframe.onload = function() {
            iframeLoaded = true;
            document.getElementById('iframe-status').innerHTML = '<div class="success">‚úÖ Iframe loaded successfully!</div>';
            
            // Try to access iframe content (will fail due to same-origin policy, but that's normal)
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                if (iframeDoc) {
                    document.getElementById('iframe-status').innerHTML += '<div class="success">‚úÖ Iframe content accessible</div>';
                }
            } catch (e) {
                document.getElementById('iframe-status').innerHTML += '<div class="warning">‚ö†Ô∏è Iframe content blocked (normal for cross-origin)</div>';
            }
        };
        
        iframe.onerror = function() {
            document.getElementById('iframe-errors').innerHTML = '<div class="error">‚ùå Iframe failed to load</div>';
        };
        
        // Timeout check
        setTimeout(() => {
            if (!iframeLoaded) {
                document.getElementById('iframe-status').innerHTML = '<div class="error">‚ùå Iframe loading timeout</div>';
            }
        }, 10000);
        
        // Update Wix code with current URL
        const currentUrl = window.location.origin;
        document.getElementById('wix-code').innerHTML = document.getElementById('wix-code').innerHTML.replace('https://your-deployed-url.replit.app/', currentUrl + '/');
    </script>
</body>
</html>